---
title: "PSET 4"
author: "Dasha Metropolitansky"
date: "February 26, 2019"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
library(readr)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(gt)

#Reading in the CSV file
poll = read_csv("ps_4_elections-poll-nc09-3.csv")
```

#Question 1

```{r include = FALSE}
dem_supporters = poll %>%
  filter(response == "Dem") %>%
  count()
```
There were `r dem_supporters[1,1]` respondents who supported the Democratic candidate.

```{r include = FALSE}
rep_vs_und = poll %>%
  filter(response %in% c("Rep", "Und")) %>%
  group_by(response) %>%
  count()
```
There were `r rep_vs_und[1,2] - rep_vs_und[2,2]` more respondents who favored the Republican candidate than who were Undecided.

```{r include = FALSE}
gender_diff = poll %>%
  filter(gender != gender_combined) %>%
  count()
```
There are two gender variables (`gender` and `gender_combined`). There are `r gender_diff[1,1]` individuals for whom these variables have different values.

```{r include = FALSE}
white = poll %>%
  filter(race_eth == "White" & file_race_black != "White") %>%
  count() 
```
There are `r white[1,1]` respondents listed as “White” under `race_eth` who are not listed as “White” under `file_race_black`. 

```{r include = FALSE}
times = poll %>%
  filter(response %in% c("Dem", "Rep")) %>%
  group_by(response) %>%
  summarize(min = min(timestamp)) %>%
  spread(key = response, value = min) %>%
  mutate(diff = round(Rep - Dem, digits = 0))
```
The first `response` of Dem came `r times[1,3]` minutes (rounded to the nearest minute) before the first response of Rep. 

#Question 2

```{r echo = FALSE, message = FALSE}
poll %>%
  select(response, race_eth, final_weight) %>%
  filter(race_eth != "[DO NOT READ] Don't know/Refused", 
         response %in% c("Dem", "Rep", "Und", 3)) %>%
  mutate(race_eth = fct_relevel(race_eth, c("White", "Black", "Hispanic", "Asian", "Other"))) %>%
  group_by(race_eth, response) %>%
  summarize(total = sum(final_weight)) %>%
  spread(key = response, value = total, fill = 0) %>%
  ungroup() %>%
  mutate(all = Dem + Rep + Und + `3`) %>%
  mutate(Dem = Dem/all) %>%
  mutate(Rep = Rep/all) %>%
  mutate(Und = Und/all) %>%
  select(-all, -`3`) %>%
  na_if(0) %>%
  gt() %>%
  tab_header(title = "North Carolina’s 9th Congressional District", 
             subtitle = "2018 3rd wave polling data broken down by race") %>%
  cols_label(Dem = "DEM.", Rep = "REP.", Und = "UND.", race_eth = " ") %>%
  fmt_percent(columns = vars(Dem, Rep, Und), decimals = 0) %>%
  fmt_missing(columns = 4, rows = 4, missing_text = "-") %>%
  tab_style(style = cells_styles(bkgd_color = "white"),
            locations = cells_data(columns = vars(race_eth))) %>%
  tab_style(style = cells_styles(bkgd_color = "#ECECEC"),
            locations = cells_data(columns = vars(Dem, Rep, Und))) %>%
  tab_style(style = cells_styles(bkgd_color = "red", text_color = "white"),
            locations = cells_data(columns = vars(Rep), rows = Rep > Dem)) %>%
  tab_style(style = cells_styles(bkgd_color = "blue", text_color = "white"),
            locations = cells_data(columns = vars(Dem), rows = Dem > Rep)) %>% 
  tab_source_note(md("Source: New York Times Upshot/Siena College 2018 live polls"))
```

#Question 3

```{r echo = FALSE, message = FALSE}
poll %>%
  filter(educ != "[DO NOT READ] Refused") %>%
  mutate(educ = fct_relevel(educ, c("Grade school", "High school", "Some college or trade school",
                                    "Bachelors' degree", "Graduate or Professional Degree"))) %>%
  group_by(educ) %>%
  ggplot(aes(x = educ, y = final_weight)) + 
  coord_flip() +
  geom_violin() + 
  geom_jitter(alpha = 0.5, size = 1) + 
  theme_gray() + 
  labs(title = "More Educated Matters Less in North Carolina 9th",
       subtitle = "Poll gives more weight to people who are less likely to participate in polls",
       caption = "New York Times Upshot/Siena College 2018 live polls") + 
  xlab(element_blank()) +
  ylab("Weight Given to Respondent in Calculating Poll Results")
```

